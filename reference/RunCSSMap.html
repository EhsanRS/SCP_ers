<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Single-cell reference mapping with CSS method"><title>Single-cell reference mapping with CSS method — RunCSSMap • SCP</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Single-cell reference mapping with CSS method — RunCSSMap"><meta property="og:description" content="Single-cell reference mapping with CSS method"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SCP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/zhanghao-njmu/SCP">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Single-cell reference mapping with CSS method</h1>
      <small class="dont-index">Source: <a href="https://github.com/zhanghao-njmu/SCP/blob/HEAD/R/SCP-projection.R" class="external-link"><code>R/SCP-projection.R</code></a></small>
      <div class="d-none name"><code>RunCSSMap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Single-cell reference mapping with CSS method</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">RunCSSMap</span><span class="op">(</span></span>
<span>  <span class="va">srt_query</span>,</span>
<span>  <span class="va">srt_ref</span>,</span>
<span>  query_assay <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_assay <span class="op">=</span> <span class="va">srt_ref</span><span class="op">[[</span><span class="va">ref_css</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">assay.used</span>,</span>
<span>  ref_css <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_umap <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ref_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  projection_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"knn"</span><span class="op">)</span>,</span>
<span>  nn_method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  distance_metric <span class="op">=</span> <span class="st">"cosine"</span>,</span>
<span>  vote_fun <span class="op">=</span> <span class="st">"mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>srt_query</dt>
<dd><p>An object of class Seurat storing the query cells.</p></dd>


<dt>srt_ref</dt>
<dd><p>An object of class Seurat storing the reference cells.</p></dd>


<dt>query_assay</dt>
<dd><p>A character string specifying the assay name for the query cells. If not provided, the default assay for the query object will be used.</p></dd>


<dt>ref_assay</dt>
<dd><p>A character string specifying the assay name for the reference cells. If not provided, the default assay for the reference object will be used.</p></dd>


<dt>ref_css</dt>
<dd><p>A character string specifying the name of the CSS reduction in the reference object to use for calculating the distance metric.</p></dd>


<dt>ref_umap</dt>
<dd><p>A character string specifying the name of the UMAP reduction in the reference object. If not provided, the first UMAP reduction found in the reference object will be used.</p></dd>


<dt>ref_group</dt>
<dd><p>A character string specifying a metadata column name in the reference object to use for grouping.</p></dd>


<dt>projection_method</dt>
<dd><p>A character string specifying the projection method to use. Options are "model" and "knn". If "model" is selected, the function will try to use a pre-trained UMAP model in the reference object for projection. If "knn" is selected, the function will directly find the nearest neighbors using the distance metric.</p></dd>


<dt>nn_method</dt>
<dd><p>A character string specifying the nearest neighbor search method to use. Options are "raw", "annoy", and "rann". If "raw" is selected, the function will use the brute-force method to find the nearest neighbors. If "annoy" is selected, the function will use the Annoy library for approximate nearest neighbor search. If "rann" is selected, the function will use the RANN library for approximate nearest neighbor search. If not provided, the function will choose the search method based on the size of the query and reference datasets.</p></dd>


<dt>k</dt>
<dd><p>An integer specifying the number of nearest neighbors to find for each cell in the query object.</p></dd>


<dt>distance_metric</dt>
<dd><p>A character string specifying the distance metric to use for calculating the pairwise distances between cells. Options include: "pearson", "spearman", "cosine", "correlation", "jaccard", "ejaccard", "dice", "edice", "hamman", "simple matching", and "faith". Additional distance metrics can also be used, such as "euclidean", "manhattan", "hamming", etc.</p></dd>


<dt>vote_fun</dt>
<dd><p>A character string specifying the function to be used for aggregating the nearest neighbors in the reference object. Options are "mean", "median", "sum", "min", "max", "sd", "var", etc. If not provided, the default is "mean".</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"panc8_sub"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">srt_ref</span> <span class="op">&lt;-</span> <span class="va">panc8_sub</span><span class="op">[</span>, <span class="va">panc8_sub</span><span class="op">$</span><span class="va">tech</span> <span class="op">!=</span> <span class="st">"fluidigmc1"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">srt_query</span> <span class="op">&lt;-</span> <span class="va">panc8_sub</span><span class="op">[</span>, <span class="va">panc8_sub</span><span class="op">$</span><span class="va">tech</span> <span class="op">==</span> <span class="st">"fluidigmc1"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">srt_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="Integration_SCP.html">Integration_SCP</a></span><span class="op">(</span><span class="va">srt_ref</span>, batch <span class="op">=</span> <span class="st">"tech"</span>, integration_method <span class="op">=</span> <span class="st">"CSS"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:25.31845] Start CSS_integrate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:25.385744] Spliting srtMerge into srtList by column tech... ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:25.56346] Checking srtList... ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 1/4 of the srtList is raw_normalized_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 1/4 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 2/4 of the srtList is raw_normalized_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 2/4 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 3/4 of the srtList is raw_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 3/4 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data 4/4 of the srtList is raw_counts. Perform NormalizeData(LogNormalize) on the data ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform FindVariableFeatures on the data 4/4 of the srtList...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use the separate HVF from srtList...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of available HVF: 2000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:27.375019] Finished checking.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:27.914751] Perform ScaleData on the data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:27.995179] Perform linear dimension reduction (pca) on the data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:28.380261] Perform integration(CSS) on the data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> CSS integration using Reduction(CSSpca, dims:1-10) as input</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: Seurat</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: SeuratObject</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: sp</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘sp’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:IRanges’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     %over%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ‘SeuratObject’ was built under R 4.3.0 but the current version is 4.3.2; it is recomended that you</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> reinstall ‘SeuratObject’ as the ABI for R may have changed</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘SeuratObject’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:IRanges’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:S4Vectors’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:BiocGenerics’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The following arguments are not used: force.recalc</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The following arguments are not used: force.recalc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:31.243986] Perform FindClusters (louvain) on the data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:31.347949] Reorder clusters...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Perform nonlinear dimension reduction (umap) on the data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Non-linear dimensionality reduction(umap) using Reduction(CSS, dims:1-22) as input</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Found more than one class "dist" in cache; using the first, from namespace 'BiocGenerics'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Also defined by ‘spam’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Found more than one class "dist" in cache; using the first, from namespace 'BiocGenerics'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Also defined by ‘spam’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Non-linear dimensionality reduction(umap) using Reduction(CSS, dims:1-22) as input</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Found more than one class "dist" in cache; using the first, from namespace 'BiocGenerics'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Also defined by ‘spam’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Found more than one class "dist" in cache; using the first, from namespace 'BiocGenerics'</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Also defined by ‘spam’</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2023-11-20 16:31:38.990704] CSS_integrate done</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Elapsed time: 13.67 secs </span>
<span class="r-in"><span><span class="fu"><a href="CellDimPlot.html">CellDimPlot</a></span><span class="op">(</span><span class="va">srt_ref</span>, group.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"celltype"</span>, <span class="st">"tech"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="RunCSSMap-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Projection</span></span></span>
<span class="r-in"><span><span class="va">srt_query</span> <span class="op">&lt;-</span> <span class="fu">RunCSSMap</span><span class="op">(</span>srt_query <span class="op">=</span> <span class="va">srt_query</span>, srt_ref <span class="op">=</span> <span class="va">srt_ref</span>, ref_css <span class="op">=</span> <span class="st">"CSS"</span>, ref_umap <span class="op">=</span> <span class="st">"CSSUMAP2D"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected srt_query data type: raw_normalized_counts</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Detected srt_ref data type: log_normalized_counts</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Data type is unknown or different between srt_query and srt_ref.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Run CSS projection</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in validObject(.Object):</span> invalid class “DimReduc” object: dimension names for ‘cell.embeddings’ must be positive integers</span>
<span class="r-in"><span><span class="fu"><a href="ProjectionPlot.html">ProjectionPlot</a></span><span class="op">(</span>srt_query <span class="op">=</span> <span class="va">srt_query</span>, srt_ref <span class="op">=</span> <span class="va">srt_ref</span>, query_group <span class="op">=</span> <span class="st">"celltype"</span>, ref_group <span class="op">=</span> <span class="st">"celltype"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in srt_query[[query_reduction]]:</span> ‘ref.embeddings’ not found in this Seurat object</span>
<span class="r-err co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Hao Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

